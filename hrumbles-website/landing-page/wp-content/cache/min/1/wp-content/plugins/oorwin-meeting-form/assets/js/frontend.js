(function(){function debugLog(f,msg){try{if(window.OWF2&&OWF2.debug){var bar=f.querySelector('.ow2-debugbar');if(!bar){bar=document.createElement('div');bar.className='ow2-debugbar';bar.style.cssText='margin-top:10px;border-radius:8px;padding:8px 10px;font:13px/1.35 system-ui;background:#fff8e5;border:1px solid #facc15;color:#854d0e';(f.querySelector('.ow2-panel.is-active .ow2-actions')||f).appendChild(bar)}
bar.textContent='['+(new Date().toLocaleTimeString())+'] '+String(msg)}
console.log('[OWF2]',msg)}catch(e){}}
function ensurePrepared(f){if(!f.getAttribute('action')||f.getAttribute('action')==='#')f.setAttribute('action',OWF2.postUrl);var a=f.querySelector('input[name="action"]');if(!a){a=document.createElement('input');a.type='hidden';a.name='action';f.appendChild(a)}a.value=OWF2.actionPost;var n=f.querySelector('input[name="owf2_nonce"]');if(!n){n=document.createElement('input');n.type='hidden';n.name='owf2_nonce';f.appendChild(n)}n.value=OWF2.nonce}
function splitName(full){full=String(full||'').trim().replace(/\s+/g,' ');if(!full)return{first:'',last:'-'};var parts=full.split(' ');if(parts.length===1)return{first:parts[0],last:'-'};return{first:parts.slice(0,-1).join(' '),last:parts.slice(-1)[0]}}
function setIframePrefill(f){var iframe=f.querySelector('#ow2-iframe');if(!iframe)return;var base=iframe.dataset.baseurl||iframe.src||'';if(!base)return;var nm=f.querySelector('#ow2-name')?.value||'';var em=f.querySelector('#ow2-email')?.value||'';var sp=splitName(nm);var qs='embed=true'+'&firstname='+encodeURIComponent(sp.first)+'&lastname='+encodeURIComponent(sp.last)+'&email='+encodeURIComponent(em);var url=base+(base.indexOf('?')>-1?'&':'?')+qs;iframe.src=url;debugLog(f,'iframe set -> '+url);iframe.addEventListener('load',function(){debugLog(f,'iframe loaded')},{once:!0})}
function initForm(f){if(!f||f.__owf2_inited)return;f.__owf2_inited=!0;ensurePrepared(f);debugLog(f,'init');var phone=f.querySelector('#ow2-phone');if(phone&&!phone.getAttribute('countries-src')&&window.OWF2&&OWF2.countriesSrc){phone.setAttribute('countries-src',OWF2.countriesSrc)}
function to(step){f.querySelectorAll('.ow2-panel').forEach(function(p){p.classList.toggle('is-active',p.dataset.panel==String(step))});var s1=f.querySelector('.ow2-step[data-step="1"]');var s2=f.querySelector('.ow2-step[data-step="2"]');if(s1&&s2){s1.classList.toggle('is-active',step==1);s1.classList.toggle('is-done',step>1);s2.classList.toggle('is-active',step==2)}
var pb=f.querySelector('.ow2-progress-bar');if(pb)pb.style.width=(step==2?'100%':'0%');f.scrollIntoView({behavior:'smooth',block:'start'})}
function fieldError(el,msg){var g=el&&el.closest?el.closest('.ow2-field-group'):null;if(!g)return;g.classList.add('ow2-error');var h=g.querySelector('.ow2-error-msg');if(!h){h=document.createElement('div');h.className='ow2-error-msg';g.appendChild(h)}
h.textContent=msg||'Required'}
function clearErrors(){f.querySelectorAll('.ow2-field-group').forEach(function(g){g.classList.remove('ow2-error');var h=g.querySelector('.ow2-error-msg');if(h)h.remove()})}
function isBusinessEmail(v){var free=["gmail.com","googlemail.com","yahoo.com","yahoo.es","hotmail.com","outlook.com","live.com","msn.com","aol.com","icloud.com","me.com","mac.com","proton.me","protonmail.com","gmx.com","yandex.com","zoho.com","pm.me","mail.com","fastmail.com","hey.com","inbox.com"];var m=/^[^\s@]+@([^\s@]+\.[^\s@]+)$/.exec(String(v||'').toLowerCase());return!!m&&free.indexOf(m[1])===-1}
function validateStep1(){clearErrors();var ok=!0;var name=f.querySelector('#ow2-name');if(!name||!name.value.trim()){fieldError(name,'Please enter your name.');ok=!1}
var comp=f.querySelector('#ow2-company');if(!comp||!comp.value.trim()){fieldError(comp,'Please enter your company.');ok=!1}
var mail=f.querySelector('#ow2-email');if(!mail||!mail.value.trim()){fieldError(mail,'Please use your business email.');ok=!1}else if(!isBusinessEmail(mail.value)){fieldError(mail,'Please use your business email (no Gmail/Outlook/Yahoo, etc.).');ok=!1}
var phoneHost=f.querySelector('#ow2-phone');var phoneFull=phoneHost?.querySelector('input[name="phone_full"]')?.value||'';var justDigits=(phoneFull.replace(/^\+\d{1,4}/,'').replace(/\D+/g,''));if(!justDigits||justDigits.length<7){fieldError(phoneHost,'Please enter a valid phone number.');ok=!1}
debugLog(f,'validate -> '+ok);return ok}
function msgBox(){var scope=f.querySelector('.ow2-panel.is-active .ow2-actions')||f;var box=scope.querySelector('.ow2-message[data-loc="active"]');if(!box){box=document.createElement('div');box.className='ow2-message';box.dataset.loc='active';scope.appendChild(box)}
f.querySelectorAll('.ow2-message:not([data-loc="active"])').forEach(function(x){x.style.display='none'});return box}
function submitViaAjax(advanceOnSuccess){var btn=f.querySelector('#ow2-next')||f.querySelector('button[type="submit"]');if(btn){btn.disabled=!0;btn.setAttribute('aria-busy','true')}
var msg=msgBox();msg.classList.remove('error');msg.textContent='Sendingâ€¦';msg.style.display='block';var fd=new FormData(f);if(!fd.get('owf_form'))fd.set('owf_form',f.getAttribute('data-owf-form')||document.title||'Website Form');fd.set('action',OWF2.actionAjax);debugLog(f,'fetch -> '+OWF2.ajaxUrl);return fetch(OWF2.ajaxUrl,{method:'POST',body:fd,credentials:'same-origin'}).then(function(r){debugLog(f,'status '+r.status);var ct=r.headers.get('content-type')||'';return ct.indexOf('json')>-1?r.json():null}).then(function(j){debugLog(f,'json <- '+JSON.stringify(j));if(!j||!j.success)throw new Error((j&&j.data&&j.data.message)||OWF2.errorMsg||'Sorry, something went wrong.');msg.classList.remove('error');msg.textContent=(j.data&&j.data.message)||OWF2.inlineMsg||'Thanks!';if(advanceOnSuccess){to(2);setIframePrefill(f);msg.style.display='none'}}).catch(function(err){console.error('[OWF2] submit error',err);msg.classList.add('error');msg.textContent=err&&err.message?err.message:(OWF2.errorMsg||'Sorry, something went wrong.');msg.style.display='block';throw err}).finally(function(){if(btn){btn.disabled=!1;btn.removeAttribute('aria-busy')}})}
f.addEventListener('submit',function(ev){ev.preventDefault();if(!validateStep1()){debugLog(f,'validation failed');return}
submitViaAjax(!0).catch(function(){})})}
function boot(){document.querySelectorAll('form.ow2-form').forEach(initForm)}
if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',boot);else boot();new MutationObserver(function(m){m.forEach(function(x){(x.addedNodes||[]).forEach(function(n){if(n.nodeType!==1)return;if(n.matches&&n.matches('form.ow2-form'))initForm(n);n.querySelectorAll&&n.querySelectorAll('form.ow2-form').forEach(initForm)})})}).observe(document.documentElement,{childList:!0,subtree:!0})})()